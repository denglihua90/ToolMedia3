# ToolMedia3 - 播放器横屏播放时屏幕锁屏功能实现计划

## 1. 项目背景

ToolMedia3是一个功能完善的视频播放应用，支持全屏控制、手势操作等功能。为了提升用户体验，特别是在横屏播放时，需要添加屏幕锁屏功能，防止用户误触屏幕导致播放中断或其他操作。

## 2. 实现计划

### 2.1 界面修改

## [ ] Task 1: 在控制器布局中添加锁屏按钮
- **优先级**：P0
- **依赖**：无
- **描述**：
  - 在 layout_video_controller.xml 文件的顶部控制器中添加一个锁屏按钮
  - 按钮位置在速度按钮的右侧
  - 按钮默认显示为解锁状态图标
- **成功标准**：
  - 锁屏按钮在控制器中正确显示
  - 按钮图标清晰可见
- **测试要求**：
  - `human-judgement` TR-1.1：验证锁屏按钮在控制器中的位置和外观
  - `human-judgement` TR-1.2：验证按钮在不同屏幕尺寸下的显示效果
- **Notes**：需要添加锁屏和解锁的图标资源

### 2.2 功能实现

## [ ] Task 2: 在VideoController中添加锁屏相关变量和方法
- **优先级**：P0
- **依赖**：Task 1
- **描述**：
  - 添加锁屏状态变量
  - 添加锁屏和解锁方法
  - 为锁屏按钮添加点击监听器
  - 实现触摸事件的拦截逻辑
- **成功标准**：
  - 锁屏按钮点击后能够切换锁屏状态
  - 锁屏状态下能够拦截触摸事件
  - 解锁状态下能够正常响应触摸事件
- **测试要求**：
  - `human-judgement` TR-2.1：验证锁屏按钮点击后状态切换
  - `human-judgement` TR-2.2：验证锁屏状态下触摸事件被拦截
  - `human-judgement` TR-2.3：验证解锁状态下触摸事件正常响应
- **Notes**：需要在触摸事件监听器中添加锁屏状态的判断

## [ ] Task 3: 实现锁屏UI提示
- **优先级**：P1
- **依赖**：Task 2
- **描述**：
  - 在锁屏和解锁时显示相应的提示信息
  - 提示信息显示一段时间后自动消失
- **成功标准**：
  - 锁屏时显示"已锁屏"提示
  - 解锁时显示"已解锁"提示
  - 提示信息能够自动消失
- **测试要求**：
  - `human-judgement` TR-3.1：验证锁屏时显示提示信息
  - `human-judgement` TR-3.2：验证解锁时显示提示信息
  - `human-judgement` TR-3.3：验证提示信息能够自动消失
- **Notes**：可以复用现有的手势反馈UI来显示提示信息

### 2.3 集成与测试

## [ ] Task 4: 与ScreenController集成
- **优先级**：P1
- **依赖**：Task 2
- **描述**：
  - 在ScreenController中添加锁屏相关的方法
  - 确保退出全屏时自动解锁
  - 确保横屏模式下锁屏功能正常工作
- **成功标准**：
  - 退出全屏时自动解锁屏幕
  - 横屏模式下锁屏功能正常工作
  - 竖屏模式下锁屏功能不可用
- **测试要求**：
  - `human-judgement` TR-4.1：验证退出全屏时自动解锁
  - `human-judgement` TR-4.2：验证横屏模式下锁屏功能正常
  - `human-judgement` TR-4.3：验证竖屏模式下锁屏功能不可用
- **Notes**：需要在ScreenController的enterFullScreen和exitFullScreen方法中添加锁屏相关逻辑

## [ ] Task 5: 测试与优化
- **优先级**：P2
- **依赖**：Task 3, Task 4
- **描述**：
  - 测试锁屏功能在不同场景下的表现
  - 优化锁屏功能的用户体验
  - 修复可能存在的bug
- **成功标准**：
  - 锁屏功能在各种场景下都能正常工作
  - 用户体验流畅，无卡顿
  - 无明显bug
- **测试要求**：
  - `human-judgement` TR-5.1：测试锁屏功能在不同场景下的表现
  - `human-judgement` TR-5.2：评估锁屏功能的用户体验
  - `programmatic` TR-5.3：确保应用无崩溃或异常
- **Notes**：需要测试的场景包括：正常播放、拖动进度条、切换全屏、网络波动等

## 3. 技术实现细节

### 3.1 锁屏状态管理

- 使用一个布尔变量 `isScreenLocked` 来跟踪锁屏状态
- 锁屏状态下，拦截所有触摸事件，只响应解锁按钮的点击
- 解锁状态下，正常处理所有触摸事件

### 3.2 触摸事件拦截

- 在 `setOnTouchListener` 中添加锁屏状态的判断
- 如果屏幕已锁定，直接返回 true，不处理触摸事件
- 解锁按钮的点击事件需要单独处理，不受锁屏状态影响

### 3.3 锁屏UI提示

- 复用现有的 `gesture_controller` 布局来显示锁屏/解锁提示
- 使用 `showGestureFeedback` 方法显示提示信息
- 设置适当的提示文本和图标

### 3.4 与全屏功能集成

- 在进入全屏时，默认不锁定屏幕
- 在退出全屏时，自动解锁屏幕
- 确保锁屏状态不影响全屏切换功能

## 4. 预期效果

1. **横屏播放时**：
   - 控制器显示锁屏按钮
   - 点击锁屏按钮后，屏幕锁定，触摸事件被拦截
   - 显示"已锁屏"提示
   - 屏幕中央显示解锁按钮
   - 点击解锁按钮后，屏幕解锁，恢复正常操作
   - 显示"已解锁"提示

2. **退出全屏时**：
   - 自动解锁屏幕
   - 恢复正常操作

3. **竖屏模式**：
   - 锁屏按钮不可见或禁用
   - 锁屏功能不可用

## 5. 风险与注意事项

1. **触摸事件拦截**：需要确保锁屏状态下能够正确拦截所有触摸事件，包括手势操作
2. **解锁按钮**：需要确保解锁按钮在锁屏状态下能够正常响应点击事件
3. **全屏切换**：需要确保锁屏状态不影响全屏切换功能
4. **用户体验**：需要确保锁屏和解锁操作流畅，提示信息清晰明了
5. **兼容性**：需要确保锁屏功能在不同设备和Android版本上都能正常工作

通过以上实现计划，我们可以为ToolMedia3应用添加屏幕锁屏功能，提升用户在横屏播放时的体验，防止误触导致的播放中断或其他操作。