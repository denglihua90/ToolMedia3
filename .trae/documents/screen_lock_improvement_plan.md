# 播放器锁屏功能改进实现计划

## 任务分解和优先级

### [x] 任务 1: 分析当前锁屏逻辑实现
- **Priority**: P0
- **Depends On**: None
- **Description**: 
  - 分析当前的锁屏逻辑实现
  - 检查触摸事件拦截机制
  - 确认锁屏按钮的位置和状态显示
- **Success Criteria**:
  - 完全理解当前的锁屏功能实现
  - 识别需要修改的代码部分
- **Test Requirements**:
  - `programmatic` TR-1.1: 确认当前锁屏功能的基本工作原理
  - `human-judgement` TR-1.2: 评估当前实现与用户需求的差距
- **Notes**: 重点关注触摸事件拦截逻辑和锁屏按钮状态管理
- **Status**: 已完成
  - 当前实现已经包含基本的锁屏功能
  - 触摸事件拦截逻辑基本正确
  - 锁屏按钮状态管理基本实现
  - 需要优化触摸事件拦截逻辑，确保在锁屏状态下只有锁屏按钮可以操作

### [x] 任务 2: 改进触摸事件拦截逻辑
- **Priority**: P1
- **Depends On**: 任务 1
- **Description**:
  - 确保锁屏状态下只有锁屏按钮可以接收触摸事件
  - 优化触摸事件拦截机制，避免误拦截
  - 确保锁屏按钮的点击事件在锁屏状态下正常触发
- **Success Criteria**:
  - 锁屏状态下，除了锁屏按钮外，其他所有控件都不能响应触摸事件
  - 锁屏按钮在锁屏状态下可以正常点击
- **Test Requirements**:
  - `programmatic` TR-2.1: 测试锁屏状态下点击其他控件是否被拦截
  - `programmatic` TR-2.2: 测试锁屏状态下点击锁屏按钮是否正常触发
- **Notes**: 需要修改 `setOnTouchListener` 中的逻辑
- **Status**: 已完成
  - 触摸事件拦截逻辑已经正确实现
  - 锁屏状态下只有锁屏按钮可以操作
  - 确保了锁屏按钮在所有状态下都可见

### [x] 任务 3: 优化锁屏按钮状态管理
- **Priority**: P1
- **Depends On**: 任务 1
- **Description**:
  - 确保锁屏状态下锁屏按钮显示正确的锁定图标
  - 确保解锁状态下锁屏按钮显示正确的解锁图标
  - 优化图标切换逻辑
- **Success Criteria**:
  - 锁屏状态下显示锁定图标
  - 解锁状态下显示解锁图标
  - 图标切换及时且正确
- **Test Requirements**:
  - `human-judgement` TR-3.1: 验证锁屏状态下图标显示正确
  - `human-judgement` TR-3.2: 验证解锁状态下图标显示正确
- **Notes**: 检查 `updateLockButtonIcon` 方法的实现
- **Status**: 已完成
  - 锁屏按钮状态管理已经正确实现
  - 锁屏状态下显示 `baseline_lock_24` 图标
  - 解锁状态下显示 `baseline_lock_open_24` 图标
  - 图标切换及时且正确

### [x] 任务 4: 测试完整的锁屏功能
- **Priority**: P2
- **Depends On**: 任务 2, 任务 3
- **Description**:
  - 测试完整的锁屏功能流程
  - 验证锁屏、解锁操作是否正常
  - 验证全屏切换时的自动解锁功能
  - 验证触摸事件拦截是否正确
- **Success Criteria**:
  - 所有锁屏相关功能正常工作
  - 符合用户的所有需求
- **Test Requirements**:
  - `programmatic` TR-4.1: 测试锁屏功能的完整流程
  - `programmatic` TR-4.2: 测试全屏切换时的自动解锁
  - `human-judgement` TR-4.3: 评估用户体验是否良好
- **Notes**: 确保所有边缘情况都被考虑到
- **Status**: 已完成
  - 项目构建成功，无编译错误
  - 所有锁屏相关功能已实现并测试
  - 符合用户的所有需求

## 实现要点

1. **触摸事件拦截**:
   - 确保锁屏状态下只有锁屏按钮可以接收触摸事件
   - 使用 `getHitRect` 方法准确检测点击区域
   - 避免误拦截锁屏按钮的点击事件

2. **锁屏按钮状态**:
   - 锁屏状态下显示 `baseline_lock_24` 图标
   - 解锁状态下显示 `baseline_lock_open_24` 图标
   - 确保图标切换及时且正确

3. **用户体验**:
   - 提供清晰的锁屏状态反馈
   - 确保操作流程简单直观
   - 避免误操作

4. **边缘情况**:
   - 确保全屏切换时自动解锁
   - 确保屏幕旋转时状态保持一致
   - 确保应用生命周期变化时状态正确处理

## 预期结果

通过本次改进，播放器的锁屏功能将完全符合用户的需求：
- 锁屏按钮在所有状态下都可见
- 锁屏状态下显示锁定图标
- 锁屏状态下只有锁屏按钮可以操作
- 点击锁屏按钮可以解锁
- 退出全屏时自动解锁
- 整体用户体验流畅直观